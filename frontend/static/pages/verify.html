<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Verify Email</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script src="https://unpkg.com/htmx.org/dist/ext/json-enc.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.3/dist/cdn.min.js" defer></script>
  <link rel="stylesheet" href="/static/css/styles.css">
  <script src="/static/js/app.js"></script>
</head>
<body class="auth-page" x-data="{ email: (new URLSearchParams(window.location.search).get('email') || '').trim() }">
  <nav class="navbar navbar-dark glass-nav">
    <div class="container d-flex align-items-center">
      <div class="d-flex align-items-center gap-3">
        <a class="navbar-brand fw-bold fs-4 mb-0 me-0" href="/">
          <span class="text-primary">I</span>CP
        </a>
      </div>
    </div>
  </nav>

  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-5">
        <div class="auth-card p-4 p-md-5 animate-fade-in">
          <h2 class="auth-header mb-2">Verify Your Email</h2>
          <p class="text-secondary mb-4 small">Please enter the 6-digit OTP sent to your email.</p>
          
          <div id="verify-msg"></div>
          
          <form hx-post="/api/auth/verify-email" hx-trigger="submit" hx-ext="json-enc" hx-swap="none"
                hx-on::before-request="
                  Swal.fire({
                    title: 'Verifying...',
                    allowOutsideClick: false,
                    didOpen: () => Swal.showLoading()
                  });
                "
                hx-on::after-request="
                  if(event.detail.successful){
                    Swal.fire({
                      icon: 'success',
                      title: 'Email Verified!',
                      text: 'You can now login to your account.',
                      confirmButtonText: 'Go to Login'
                    }).then(() => {
                      window.location='/static/pages/login.html';
                    });
                  } else {
                    let msg = 'Verification failed';
                    try {
                      const res = JSON.parse(event.detail.xhr.response);
                      msg = res.detail || msg;
                    } catch(e){}
                    Swal.fire({
                      icon: 'error',
                      title: 'Error',
                      text: msg
                    });
                  }
                ">
            <div class="mb-4">
              <label class="form-label text-secondary small text-uppercase fw-bold">Email Address</label>
              <input name="email" type="email" class="form-control form-control-lg" x-model="email" required readonly title="Email Address" placeholder="user@example.com">
            </div>
            
            <div class="mb-4">
              <label class="form-label text-secondary small text-uppercase fw-bold">OTP Code</label>
              <input name="otp" type="text" class="form-control form-control-lg text-center letter-spacing-lg" 
                     placeholder="000000" maxlength="6" pattern="\d{6}" required>
            </div>

            <button type="submit" class="btn btn-primary btn-lg w-100 py-3 fw-bold shadow-sm">
              Verify Account
            </button>
          </form>

          <div class="text-center mt-4">
            <p class="text-secondary small mb-0">
              Didn't receive a code? <a href="/static/pages/register.html" class="text-primary fw-bold">Try Registering Again</a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
